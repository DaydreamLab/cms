webpackJsonp([67],{"Bj2+":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("o/zv"),n=i.n(a);t.default={name:"Media",data:function(){return{params:{dir:"/",path:this.filePath,total:""},view:"list",folders:[],files:[],loading:!1,selected:[],newFolderName:"",showCreateFolderBtn:!1,showUploadFileBtn:!1,folderTreeProps:{label:"name",children:"children"}}},props:{filePath:{type:String,default:""}},watch:{selected:function(e){this.$emit("change",e)},"params.dir":function(e){this.$refs.folderTree.setCurrentKey(e)},filePath:function(e){this.params.path=e}},created:function(){this.initMedia()},methods:{handleDeleteFile:function(){var e=this;this.$$api_media_delete({data:{paths:this.selected},fn:function(){e.resetSelectedFiles()}})},updateSelectedFiles:function(e){this.selected=e.map(function(e){return e.path})},resetSelectedFiles:function(){this.selected=[],this.handleGetFiles()},onDoubleClickItem:function(e){"Folder"===e.type?this.updateParamDir(e):this.updateParamPath(e)},updateParamPath:function(e){this.params.path=e.path},updateParamDir:function(e){this.params.dir=e.path,this.resetSelectedFiles()},handleUploadFile:function(){this.$refs.fileUpload.submit()},handleUploadFiles:function(e){var t=this,i=new FormData;i.append("files[]",e.file),i.append("dir",this.params.dir),this.$$api_media_uploadFile({headers:{"Content-Type":"multipart/form-data"},data:i,fn:function(i){var a=i.msg;t.$message.success(a),e.onSuccess(),t.$refs.fileUpload.clearFiles(),t.showUploadFileBtn=!1,t.handleGetFiles()},errFn:function(i){t.$message.error(i),e.onError()}})},handleCreateFolder:function(){var e=this;this.$$api_media_createFolder({data:{dir:this.params.dir,name:this.newFolderName},fn:function(t){t.data;e.newFolderName="",e.showCreateFolderBtn=!1,e.handleGetFiles(),e.handleGetFolders()}})},handleGetFolders:function(){var e=this;this.$$api_media_listFolder({fn:function(t){var i=t.data;i.items[0].name=e.$t("GLOBAL_ROOT"),e.folders=i.items}})},handleGetFiles:function(){var e=this;this.loading=!0,this.$$api_media_listFile({data:{dir:this.params.dir},fn:function(t){var i=t.data;e.files=i.items,e.params.total=i.records,e.loading=!1}})},formatItemDate:function(e){return this.$options.filters.displayDateFormat(e.modified)},initMedia:function(){this.handleGetFolders(),this.params.path&&(this.params.dir=n.a.dirname(this.params.path)||this.params.dir,this.selected.push(this.params.path)),this.handleGetFiles()}}}},EOXh:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-container",{staticClass:"media-container"},[i("el-header",{staticClass:"media-toolbar"},[i("el-radio-group",{staticClass:"media-toolbar__item",model:{value:e.view,callback:function(t){e.view=t},expression:"view"}},[i("el-radio-button",{attrs:{label:"icon"}},[i("font-awesome-icon",{attrs:{icon:["fal","grip-horizontal"]}}),e._v("\n        "+e._s(e.$t("MEDIA_THUMB_VIEW"))+"\n      ")],1),e._v(" "),i("el-radio-button",{attrs:{label:"list"}},[i("font-awesome-icon",{attrs:{icon:["fal","bars"]}}),e._v("\n        "+e._s(e.$t("MEDIA_LIST_VIEW"))+"\n      ")],1)],1),e._v(" "),i("el-button-group",{staticClass:"media-toolbar__item"},[i("el-button",{attrs:{type:e.showUploadFileBtn?"info":"success"},on:{click:function(t){e.showUploadFileBtn=!e.showUploadFileBtn}}},[e.showUploadFileBtn?[i("font-awesome-icon",{attrs:{icon:["fal","times"]}}),e._v("\n          "+e._s(e.$t("TOOLBAR_CANCEL")+e.$t("MEDIA_UPLOAD"))+"\n        ")]:[i("font-awesome-icon",{attrs:{icon:["fal","upload"]}}),e._v("\n          "+e._s(e.$t("MEDIA_UPLOAD"))+"\n        ")]],2),e._v(" "),i("el-button",{attrs:{type:e.showCreateFolderBtn?"info":""},on:{click:function(t){e.showCreateFolderBtn=!e.showCreateFolderBtn}}},[e.showCreateFolderBtn?[i("font-awesome-icon",{attrs:{icon:["fal","times"]}}),e._v("\n          "+e._s(e.$t("TOOLBAR_CANCEL")+e.$t("MEDIA_CREATE_DIR"))+"\n        ")]:[i("font-awesome-icon",{attrs:{icon:["fal","plus"]}}),e._v("\n          "+e._s(e.$t("MEDIA_CREATE_DIR"))+"\n        ")]],2)],1),e._v(" "),i("el-button-group",{staticClass:"media-toolbar__item"},[i("el-button",{attrs:{disabled:e.selected.length<=0},on:{click:e.handleDeleteFile}},[i("font-awesome-icon",{attrs:{icon:["fal","trash-alt"]}}),e._v("\n        "+e._s(e.$t("TOOLBAR_DELETE"))+"\n      ")],1)],1)],1),e._v(" "),i("el-container",[i("el-aside",{staticClass:"media-aside",attrs:{width:"200px"}},[i("el-tree",{ref:"folderTree",attrs:{"node-key":"path",data:e.folders,props:e.folderTreeProps,"expand-on-click-node":!1,"default-expand-all":"","highlight-current":""},on:{"node-click":e.updateParamDir}})],1),e._v(" "),i("el-main",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"media-main"},[i("div",{staticClass:"media-create"},[e.showCreateFolderBtn?i("el-input",{staticClass:"media-create__item",model:{value:e.newFolderName,callback:function(t){e.newFolderName=t},expression:"newFolderName"}},[i("template",{slot:"prepend"},[e._v(e._s(e.params.dir))]),e._v(" "),i("el-button",{attrs:{slot:"append"},on:{click:e.handleCreateFolder},slot:"append"},[e._v(e._s(e.$t("MEDIA_CREATE")))])],2):e._e(),e._v(" "),e.showUploadFileBtn?i("el-upload",{ref:"fileUpload",staticClass:"media-create__item",attrs:{multiple:"",action:"string","http-request":e.handleUploadFiles,"auto-upload":!1}},[i("el-button",{attrs:{slot:"trigger"},slot:"trigger"},[e._v(e._s(e.$t("MEDIA_SELECT_FILE")))]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handleUploadFile}},[e._v(e._s(e.$t("MEDIA_UPLOAD")))]),e._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(e.$t("MEDIA_UPLOAD_FILE_LIMIT")))])],1):e._e()],1),e._v(" "),"list"===e.view?i("el-table",{staticClass:"file-list__table",attrs:{data:e.files,"current-row-key":"path"},on:{"selection-change":e.updateSelectedFiles}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:e.$t("MEDIA_NAME"),width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{staticClass:"file-item__inner",on:{dblclick:function(i){e.onDoubleClickItem(t.row)}}},[i("span",{staticClass:"file-item__type"},["Folder"===t.row.type?i("font-awesome-icon",{staticClass:"file-item__icon",attrs:{icon:["fal","folder"]}}):i("span",{staticClass:"file-item__thumb",style:{backgroundImage:"url('"+t.row.thumb+"')"}})],1),e._v(" "),i("span",{staticClass:"file-item__name"},[e._v(e._s(t.row.name))])])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"type",label:e.$t("MEDIA_TYPE")}}),e._v(" "),i("el-table-column",{attrs:{prop:"size",label:e.$t("MEDIA_SIZE")}}),e._v(" "),i("el-table-column",{attrs:{prop:"modified",label:e.$t("MEDIA_MODIFIED_DATE"),formatter:e.formatItemDate}})],1):i("div",{staticClass:"file-list__icon"},e._l(e.files,function(t){return i("label",{key:t.path,staticClass:"file-item",class:{"is-selected":e.selected.indexOf(t.path)>=0}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.selected,expression:"selected"}],staticClass:"file-item__checkbox",attrs:{type:"checkbox"},domProps:{value:t.path,checked:Array.isArray(e.selected)?e._i(e.selected,t.path)>-1:e.selected},on:{change:function(i){var a=e.selected,n=i.target,r=!!n.checked;if(Array.isArray(a)){var l=t.path,o=e._i(a,l);n.checked?o<0&&(e.selected=a.concat([l])):o>-1&&(e.selected=a.slice(0,o).concat(a.slice(o+1)))}else e.selected=r}}}),e._v(" "),i("div",{staticClass:"file-item__inner",on:{dblclick:function(i){e.onDoubleClickItem(t)}}},[i("div",{staticClass:"file-item__type"},["Folder"===t.type?i("font-awesome-icon",{staticClass:"file-item__icon",attrs:{icon:["fal","folder"]}}):i("div",{staticClass:"file-item__thumb",style:{backgroundImage:"url('"+t.thumb+"')"}})],1),e._v(" "),i("div",{staticClass:"file-item__name"},[e._v(e._s(t.name))])])])}))],1)],1),e._v(" "),i("el-footer",{attrs:{height:"40px"}},[i("el-row",{staticClass:"media-footer",attrs:{type:"flex",justify:"space-between"}},[i("el-col",{attrs:{span:6}},[e._v(e._s(e.params.dir))]),e._v(" "),i("el-col",{attrs:{span:12}},[e._v(e._s(e.selected[e.selected.length-1]))]),e._v(" "),e.params.total?i("el-col",{staticClass:"text-right",attrs:{span:6}},[e._v(e._s(e.$t("MEDIA_ITEMS"))+e._s(e.params.total))]):e._e()],1)],1)],1)},staticRenderFns:[]}},SBPZ:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,'.content-container .el-main.media-main{min-height:500px;padding:10px}.content-container .el-aside.media-aside{padding:10px}.media-container{background:#fff}.media-container .el-footer,.media-container .el-header{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.media-container .el-header{border-bottom:1px solid #e6e6e6}.media-container .el-footer{border-top:1px solid #e6e6e6;color:#999}.media-container .el-aside{border-right:1px solid #e6e6e6}.media-toolbar__item{margin-right:10px}.media-create__item{margin-bottom:10px}.media-footer{width:100%}.file-list__table .el-table__row{cursor:default}.file-list__table .el-table__row .file-item__thumb{width:1em;height:1em;display:inline-block;vertical-align:middle;background-size:cover;background-color:#e6e6e6}.file-list__icon{color:#606266;padding:10px}.file-list__icon:after,.file-list__icon:before{content:"";display:table}.file-list__icon .file-item__inner{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.file-list__icon .file-item__type{width:3em;height:3em}.file-list__icon .file-item__icon{font-size:3em}.file-list__icon .file-item__thumb{width:100%;height:100%;background-size:cover;background-color:#e6e6e6}.file-list__icon .file-item__name{margin-top:10px;padding:2px 4px;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;max-height:2.4em;line-height:1.3em;white-space:pre-line;overflow:hidden;overflow-wrap:break-word;word-break:break-word;text-align:center}.file-item{width:120px;height:80px;float:left;padding-right:1.5rem;-webkit-box-sizing:border-box;box-sizing:border-box}.file-item__checkbox{opacity:0;position:absolute}.file-item.is-selected .file-item__name{background:#2f3855;color:#fff;border-radius:4px;max-height:3.8em;-webkit-line-clamp:initial;z-index:1}',""])},W2nU:function(e,t){var i,a,n=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function l(){throw new Error("clearTimeout has not been defined")}function o(e){if(i===setTimeout)return setTimeout(e,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(e){i=r}try{a="function"==typeof clearTimeout?clearTimeout:l}catch(e){a=l}}();var s,c=[],d=!1,f=-1;function u(){d&&s&&(d=!1,s.length?c=s.concat(c):f=-1,c.length&&p())}function p(){if(!d){var e=o(u);d=!0;for(var t=c.length;t;){for(s=c,c=[];++f<t;)s&&s[f].run();f=-1,t=c.length}s=null,d=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===l||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new m(e,t)),1!==c.length||d||o(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=h,n.addListener=h,n.once=h,n.off=h,n.removeListener=h,n.removeAllListeners=h,n.emit=h,n.prependListener=h,n.prependOnceListener=h,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},aP59:function(e,t,i){var a=i("SBPZ");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i("rjj0")("6e9ce0da",a,!0,{})},gPVg:function(e,t,i){var a=i("VU/8")(i("Bj2+"),i("EOXh"),!1,function(e){i("aP59")},null,null);e.exports=a.exports},"o/zv":function(e,t,i){(function(e){function i(e,t){for(var i=0,a=e.length-1;a>=0;a--){var n=e[a];"."===n?e.splice(a,1):".."===n?(e.splice(a,1),i++):i&&(e.splice(a,1),i--)}if(t)for(;i--;i)e.unshift("..");return e}var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,n=function(e){return a.exec(e).slice(1)};function r(e,t){if(e.filter)return e.filter(t);for(var i=[],a=0;a<e.length;a++)t(e[a],a,e)&&i.push(e[a]);return i}t.resolve=function(){for(var t="",a=!1,n=arguments.length-1;n>=-1&&!a;n--){var l=n>=0?arguments[n]:e.cwd();if("string"!=typeof l)throw new TypeError("Arguments to path.resolve must be strings");l&&(t=l+"/"+t,a="/"===l.charAt(0))}return t=i(r(t.split("/"),function(e){return!!e}),!a).join("/"),(a?"/":"")+t||"."},t.normalize=function(e){var a=t.isAbsolute(e),n="/"===l(e,-1);return(e=i(r(e.split("/"),function(e){return!!e}),!a).join("/"))||a||(e="."),e&&n&&(e+="/"),(a?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,i){function a(e){for(var t=0;t<e.length&&""===e[t];t++);for(var i=e.length-1;i>=0&&""===e[i];i--);return t>i?[]:e.slice(t,i-t+1)}e=t.resolve(e).substr(1),i=t.resolve(i).substr(1);for(var n=a(e.split("/")),r=a(i.split("/")),l=Math.min(n.length,r.length),o=l,s=0;s<l;s++)if(n[s]!==r[s]){o=s;break}var c=[];for(s=o;s<n.length;s++)c.push("..");return(c=c.concat(r.slice(o))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){var t=n(e),i=t[0],a=t[1];return i||a?(a&&(a=a.substr(0,a.length-1)),i+a):"."},t.basename=function(e,t){var i=n(e)[2];return t&&i.substr(-1*t.length)===t&&(i=i.substr(0,i.length-t.length)),i},t.extname=function(e){return n(e)[3]};var l="b"==="ab".substr(-1)?function(e,t,i){return e.substr(t,i)}:function(e,t,i){return t<0&&(t=e.length+t),e.substr(t,i)}}).call(t,i("W2nU"))}});